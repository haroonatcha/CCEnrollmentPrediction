---
title: 'Predicting Enrollment with Stacked Models: Bringing Together Theory and Empirics'
author: "Haroon Atcha"
date: "6/4/2021"
output: html_document

---

# Introduction

# Data

## Simulating Data

The data used in this paper was generated specifically for the purpose and was **not** gathered at any specific community college. This was done for several reasons:

1. Simulated data are generated with *known* parameters, allowing us to determine how accurately models recover *true* estimates
2. Simulated data allow for greater generalizability. Data gathered at one institution may have been generated by a process that differs dramatically from other contexts
3. Simulated data allow us to demonstrate theoretically important trends with  because we *know* all relevant parameters

## Data Generating Process

The data used in this study was generated through two processes. First, the number of new enrollees in a given semester was generated at the aggregate level (i.e. total number of new students). Second, the retention status of enrolled students in a given semester was generated at the individual level (i.e. did student n return at t + 1). Finally, the individual level predictions were aggregated and summed with the number of new enrollees to produce total headcount for a given semester. This process is visualized in chart 1. 

```{r, echo = FALSE}
knitr::include_graphics('Data Generation Process.png')
```

### Returning Enrollees

Existing students are known at the individual level and have three observed variables: Gender, current semester credit load, and cumulative credits taken. Each student's likelihood of returning in the subsequent semester is a linear function of their gender and curvilinear function of cumulative credits taken such that students are *more* likely to be retained as they approach graduation and *less* likely thereafter. Constant and error terms are also added. 

The formula used to generate each student's probability of returning is given below as are the coefficients associated with each term. As noted above, I chose to generate data using a simple model for the purpose of demonstration; Gender and cumulative credit load are widely cited predictors of retention and the values chosen for them fall within reasonable bounds.

logit(y) = $\beta_{Gender}$ + ${\beta_{Cumulative\ Credits}}^2$ + $\beta_{Cumulative\ Credits}$ + *C* + $\epsilon$

```{r, echo = FALSE}
table <- cbind(
  c('Gender', 'Credits', 'Cumulative Credits', 'Likelihood of Return', 'Return'),
  c('Binary', 'Interval', 'Interval', 'Ratio', 'Binary'),
  c(0, 1, 1, 0.02, 0),
  c(1, 21, 121, 0.83, 1),
  c(0.5, 9, 135, 0.72, 0.72),
  c('Sample (0:1)', 'Sample Truncated Normal', '$\\sum_{(i,j) = 1}^n n_{i,j}$', 'Linear Function', 'Sample (0:1)'),
  c('P(1) = 0.5', '$\\mu$ = 6, $\\sigma$ = 9', '-', 'See Equation 1', 'P(1) = Likelihood of Return'))

colnames(table) <- c('Variable', 'Level', 'Min', 'Max', 'Mean', 'Generation', 'Parameters')

knitr::kable(table)

```

### New Enrollees

The number of new enrollees in a given semester was generated at the aggregate level. No individual level characteristics are known about new enrollees *until their first semester*. The number of new enrollees in a given semester is a linear function of change in GDP and semester; values for the former were drawn randomly from a normal distribution with $\mu$ = 0 and $\sigma$ = 1. Constant and error terms are also added with final output of the model scaled up and rounded to an integer value.

The formula used to generate the number of new students each semester is given below and coefficients associated with each term can be found in the Appendix. As with the returning students model, this model was built with an eye towards parsimony and generalizability.



```{r, echo = FALSE}
table <- cbind(
c('$\\beta_{GDP}$', '$\\beta_{Spring\ Semester}$', '$\\beta_{Summer\ Semester}$', '$\\beta_{Fall\ Semester}$',
  '$C_{New Students}$', '$\\varepsilon_{New Students}$', '$\\beta_{Gender}$', '$\\beta_{Cumulative\ Credits}$',
  '$C_{Returning Students}$', '$\\varepsilon_{Returning Students}$'),
c(rep('New', 6), rep('Returning', 4)),
c(2, 3, 0, 6, 0, '$\\ N(\\mu = 0, \\sigma = 1)$', 0.1, 0.02, 0.9, '$\\ N(\\mu = 0, \\sigma = 1)$')
)

colnames(table) <- c('Term', 'Model', 'Value')

knitr::kable(table)

```

## Summary Statistics

# Methods

# Results

# Discussion

In this paper, I have demonstrated the value in bringing theoretical knowledge to bear on predictive models of enrollment. Community colleges construct such models under unique constraints. Moreover, the financial consequences of inaccurate models is more acutely felt than at other types of institutions of higher education. While the extant literature has sought improvements to predictive accuracy by using 'brute-force' methods - e.g. increasing the number of features in models, implementing more model types, exhaustively searching across model hyper-parameters - I argue that these efforts essentially re-invent the wheel insofar as they 'rediscover' relationships that are already well established. Our theoretical knowledge of the predictors of enrollment and persistence is robust. That knowledge should be reflected in our empirical models.

# Future Research

